{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@fof/pwned-passwords/webpack/bootstrap","webpack://@fof/pwned-passwords/webpack/runtime/compat get default export","webpack://@fof/pwned-passwords/webpack/runtime/define property getters","webpack://@fof/pwned-passwords/webpack/runtime/hasOwnProperty shorthand","webpack://@fof/pwned-passwords/webpack/runtime/make namespace object","webpack://@fof/pwned-passwords/external root \"flarum.core.compat['forum/app']\"","webpack://@fof/pwned-passwords/external root \"flarum.core.compat['common/extend']\"","webpack://@fof/pwned-passwords/external root \"flarum.core.compat['forum/ForumApplication']\"","webpack://@fof/pwned-passwords/external root \"flarum.core.compat['common/Model']\"","webpack://@fof/pwned-passwords/external root \"flarum.core.compat['common/models/User']\"","webpack://@fof/pwned-passwords/./node_modules/@babel/runtime/helpers/esm/extends.js","webpack://@fof/pwned-passwords/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@fof/pwned-passwords/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@fof/pwned-passwords/external root \"flarum.core.compat['common/Component']\"","webpack://@fof/pwned-passwords/external root \"flarum.core.compat['common/components/Alert']\"","webpack://@fof/pwned-passwords/external root \"flarum.core.compat['common/components/Button']\"","webpack://@fof/pwned-passwords/external root \"flarum.core.compat['common/helpers/icon']\"","webpack://@fof/pwned-passwords/./src/forum/index.ts","webpack://@fof/pwned-passwords/./src/forum/alertPwnedPassword.tsx"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/ForumApplication'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/Model'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/models/User'];","export default function _extends() {\n  _extends = Object.assign ? Object.assign.bind() : function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n  return _extends.apply(this, arguments);\n}","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/Component'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Alert'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/helpers/icon'];","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport ForumApplication from 'flarum/forum/ForumApplication';\nimport Model from 'flarum/common/Model';\nimport User from 'flarum/common/models/User';\nimport alertPwnedPassword from './alertPwnedPassword';\n\napp.initializers.add('fof/pwned-passwords', () => {\n  User.prototype.hasPwnedPassword = Model.attribute('hasPwnedPassword');\n\n  extend(ForumApplication.prototype, 'mount', function () {\n    alertPwnedPassword();\n  });\n});\n","import { VnodeDOM } from 'mithril';\nimport app from 'flarum/forum/app';\nimport Component from 'flarum/common/Component';\nimport Alert from 'flarum/common/components/Alert';\nimport Button from 'flarum/common/components/Button';\nimport icon from 'flarum/common/helpers/icon';\n\n// Based on Flarum's forum/util/alertEmailConfirmation\nexport default function alertPwnedPassword() {\n  const user = app.session.user;\n\n  if (!user || !user.hasPwnedPassword()) return;\n\n  // Don't show if email is unconfirmed, as it would cause multiple similar alerts\n  // Also, it's not supposed to be possible once the extension is enabled\n  if (!user.isEmailConfirmed()) return;\n\n  class ResendButton extends Component {\n    loading: boolean = false;\n    sent: boolean = false;\n\n    view() {\n      return (\n        <Button class=\"Button Button--link\" onclick={this.onclick.bind(this)} loading={this.loading} disabled={this.sent}>\n          {this.sent\n            ? [icon('fas fa-check'), ' ', app.translator.trans('fof-pwned-passwords.forum.alert.sent_message')]\n            : app.translator.trans('fof-pwned-passwords.forum.alert.resend_button')}\n        </Button>\n      );\n    }\n\n    onclick() {\n      this.loading = true;\n      m.redraw();\n\n      app\n        .request({\n          method: 'POST',\n          url: app.forum.attribute('apiUrl') + '/forgot',\n          body: { email: user!.email() },\n        })\n        .then(() => {\n          this.loading = false;\n          this.sent = true;\n          m.redraw();\n        })\n        .catch(() => {\n          this.loading = false;\n          m.redraw();\n        });\n    }\n  }\n\n  class ContainedAlert extends Alert {\n    view(vnode: VnodeDOM) {\n      const vdom = super.view(vnode);\n      return { ...vdom, children: [<div className=\"container\">{vdom.children}</div>] };\n    }\n  }\n\n  m.mount($('<div/>').insertBefore('#content')[0], {\n    view: () => (\n      <ContainedAlert dismissible={false} controls={[<ResendButton />]}>\n        {app.translator.trans('fof-pwned-passwords.forum.alert.warning')}\n      </ContainedAlert>\n    ),\n  });\n}\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","flarum","core","compat","_extends","assign","bind","target","i","arguments","length","source","apply","this","_setPrototypeOf","p","setPrototypeOf","__proto__","_inheritsLoose","subClass","superClass","create","constructor","app","User","Model","extend","ForumApplication","user","hasPwnedPassword","isEmailConfirmed","ResendButton","loading","sent","view","class","onclick","disabled","icon","m","redraw","method","url","body","email","then","Component","ContainedAlert","vnode","vdom","children","className","Alert","mount","$","insertBefore","dismissible","controls","alertPwnedPassword"],"sourceRoot":""}